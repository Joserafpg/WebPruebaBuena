<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta http-equiv="X-UA-Compatible" content="IE=edge" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Furniture</title>
		<link rel="stylesheet" href="styles.css" />
	</head>
	<body>
		<main class="main-content">
			<section class="container top-products">
				<h1 class="heading-1">Mejores Productos</h1>

				<div class="container-options">
					<span class="active">Destacados</span>
					<span>Más recientes</span>
					<span>Mejores Vendidos</span>
				</div>

				<div class="container-products">
					<!-- Producto 1 -->
					<div class="card-product" id="product-1">
						<div class="container-img">
							<img src="img/cafe-irish.jpg" alt="Cafe Irish" />
							<span class="discount">-13%</span>
							<div class="button-group">
								<span><i class="fa-regular fa-eye"></i></span>
								<span><i class="fa-regular fa-heart"></i></span>
								<span><i class="fa-solid fa-code-compare"></i></span>
							</div>
						</div>
						<div class="content-card-product">
							<div class="stars">
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-regular fa-star"></i>
							</div>
							<h3>Cafe Irish</h3>
							<span class="add-cart"><i class="fa-solid fa-basket-shopping"></i></span>
							<p class="price">$4.60 <span>$5.30</span></p>
						</div>
					</div>
					
					<!-- Producto 2 -->
					<div class="card-product" id="product-2">
						<div class="container-img">
							<img src="img/cafe-irish.jpg" alt="Cafe Irish" />
							<span class="discount">-13%</span>
							<div class="button-group">
								<span><i class="fa-regular fa-eye"></i></span>
								<span><i class="fa-regular fa-heart"></i></span>
								<span><i class="fa-solid fa-code-compare"></i></span>
							</div>
						</div>
						<div class="content-card-product">
							<div class="stars">
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-regular fa-star"></i>
							</div>
							<h3>Cafe Irish</h3>
							<span class="add-cart"><i class="fa-solid fa-basket-shopping"></i></span>
							<p class="price">$4.60 <span>$5.30</span></p>
						</div>
					</div>
					
					<!-- Producto 3 -->
					<div class="card-product" id="product-3">
						<div class="container-img">
							<img src="img/cafe-irish.jpg" alt="Cafe Irish" />
							<span class="discount">-13%</span>
							<div class="button-group">
								<span><i class="fa-regular fa-eye"></i></span>
								<span><i class="fa-regular fa-heart"></i></span>
								<span><i class="fa-solid fa-code-compare"></i></span>
							</div>
						</div>
						<div class="content-card-product">
							<div class="stars">
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-regular fa-star"></i>
							</div>
							<h3>Cafe Irish</h3>
							<span class="add-cart"><i class="fa-solid fa-basket-shopping"></i></span>
							<p class="price">$4.60 <span>$5.30</span></p>
						</div>
					</div>

					
					<!-- Producto 4 -->
					<div class="card-product" id="product-4">
						<div class="container-img">
							<img src="img/cafe-irish.jpg" alt="Cafe Irish" />
							<span class="discount">-13%</span>
							<div class="button-group">
								<span><i class="fa-regular fa-eye"></i></span>
								<span><i class="fa-regular fa-heart"></i></span>
								<span><i class="fa-solid fa-code-compare"></i></span>
							</div>
						</div>
						<div class="content-card-product">
							<div class="stars">
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-regular fa-star"></i>
							</div>
							<h3>Cafe Irish</h3>
							<span class="add-cart"><i class="fa-solid fa-basket-shopping"></i></span>
							<p class="price">$4.60 <span>$5.30</span></p>
						</div>
					</div>

					
					<!-- Producto 5 -->
					<div class="card-product" id="product-5">
						<div class="container-img">
							<img src="img/cafe-irish.jpg" alt="Cafe Irish" />
							<span class="discount">-13%</span>
							<div class="button-group">
								<span><i class="fa-regular fa-eye"></i></span>
								<span><i class="fa-regular fa-heart"></i></span>
								<span><i class="fa-solid fa-code-compare"></i></span>
							</div>
						</div>
						<div class="content-card-product">
							<div class="stars">
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-regular fa-star"></i>
							</div>
							<h3>Cafe Irish</h3>
							<span class="add-cart"><i class="fa-solid fa-basket-shopping"></i></span>
							<p class="price">$4.60 <span>$5.30</span></p>
						</div>
					</div>

					<!-- Producto 6 -->
					<div class="card-product" id="product-6">
						<div class="container-img">
							<img src="img/cafe-ingles.jpg" alt="Cafe Inglés" />
							<span class="discount">-22%</span>
							<div class="button-group">
								<span><i class="fa-regular fa-eye"></i></span>
								<span><i class="fa-regular fa-heart"></i></span>
								<span><i class="fa-solid fa-code-compare"></i></span>
							</div>
						</div>
						<div class="content-card-product">
							<div class="stars">
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-regular fa-star"></i>
								<i class="fa-regular fa-star"></i>
							</div>
							<h3>Cafe Inglés</h3>
							<span class="add-cart"><i class="fa-solid fa-basket-shopping"></i></span>
							<p class="price">$5.70 <span>$7.30</span></p>
						</div>
					</div>
					<!--  -->
					<div class="card-product" id="product-7">
						<div class="container-img">
							<img src="img/cafe-australiano.jpg" alt="Cafe Australiano" />
							<div class="button-group">
								<span><i class="fa-regular fa-eye"></i></span>
								<span><i class="fa-regular fa-heart"></i></span>
								<span><i class="fa-solid fa-code-compare"></i></span>
							</div>
						</div>
						<div class="content-card-product">
							<div class="stars">
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
							</div>
							<h3>Cafe Australiano</h3>
							<span class="add-cart"><i class="fa-solid fa-basket-shopping"></i></span>
							<p class="price">$3.20</p>
						</div>
					</div>
					<!--  -->
					<div class="card-product" id="product-8">
						<div class="container-img">
							<img src="img/cafe-helado.jpg" alt="Cafe Helado" />
							<div class="button-group">
								<span><i class="fa-regular fa-eye"></i></span>
								<span><i class="fa-regular fa-heart"></i></span>
								<span><i class="fa-solid fa-code-compare"></i></span>
							</div>
						</div>
						<div class="content-card-product">
							<div class="stars">
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-regular fa-star"></i>
							</div>
							<h3>Cafe Helado</h3>
							<span class="add-cart"><i class="fa-solid fa-basket-shopping"></i></span>
							<p class="price">$5.60</p>
						</div>
					</div>
				</div>
			</section>

			<section class="container specials">
				<h1 class="heading-1">Especiales</h1>

				<div class="container-products">
					<!-- Producto 9 -->
					<div class="card-product" id="product-9">
						<div class="container-img">
							<img src="img/cafe-irish.jpg" alt="Cafe Irish" />
							<span class="discount">-13%</span>
							<div class="button-group">
								<span><i class="fa-regular fa-eye"></i></span>
								<span><i class="fa-regular fa-heart"></i></span>
								<span><i class="fa-solid fa-code-compare"></i></span>
							</div>
						</div>
						<div class="content-card-product">
							<div class="stars">
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-regular fa-star"></i>
							</div>
							<h3>Cafe Irish</h3>
							<span class="add-cart"><i class="fa-solid fa-basket-shopping"></i></span>
							<p class="price">$4.60 <span>$5.30</span></p>
						</div>
					</div>
					<!-- Producto 10 -->
					<div class="card-product" id="product-10">
						<div class="container-img">
							<img src="img/cafe-ingles.jpg" alt="Cafe Inglés" />
							<span class="discount">-22%</span>
							<div class="button-group">
								<span><i class="fa-regular fa-eye"></i></span>
								<span><i class="fa-regular fa-heart"></i></span>
								<span><i class="fa-solid fa-code-compare"></i></span>
							</div>
						</div>
						<div class="content-card-product">
							<div class="stars">
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-regular fa-star"></i>
								<i class="fa-regular fa-star"></i>
							</div>
							<h3>Cafe Inglés</h3>
							<span class="add-cart"><i class="fa-solid fa-basket-shopping"></i></span>
							<p class="price">$5.70 <span>$7.30</span></p>
						</div>
					</div>
					<!--  -->
					<div class="card-product" id="product-11">
						<div class="container-img">
							<img src="img/cafe-viena.jpg" alt="Cafe Viena" />
							<span class="discount">-30%</span>
							<div class="button-group">
								<span><i class="fa-regular fa-eye"></i></span>
								<span><i class="fa-regular fa-heart"></i></span>
								<span><i class="fa-solid fa-code-compare"></i></span>
							</div>
						</div>
						<div class="content-card-product">
							<div class="stars">
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
							</div>
							<h3>Cafe Viena</h3>
							<span class="add-cart"><i class="fa-solid fa-basket-shopping"></i></span>
							<p class="price">$3.85 <span>$5.50</span></p>
						</div>
					</div>
					<!--  -->
					<div class="card-product" id="product-12">
						<div class="container-img">
							<img src="img/cafe-liqueurs.jpg" alt="Cafe Liqueurs" />
							<div class="button-group">
								<span><i class="fa-regular fa-eye"></i></span>
								<span><i class="fa-regular fa-heart"></i></span>
								<span><i class="fa-solid fa-code-compare"></i></span>
							</div>
						</div>
						<div class="content-card-product">
							<div class="stars">
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-solid fa-star"></i>
								<i class="fa-regular fa-star"></i>
							</div>
							<h3>Cafe Liqueurs</h3>
							<span class="add-cart"><i class="fa-solid fa-basket-shopping"></i></span>
							<p class="price">$5.60</p>
						</div>
					</div>
				</div>
			</section>
		</main>

		<script src="https://kit.fontawesome.com/81581fb069.js" crossorigin="anonymous"></script>
		<script type="module">
			import {WebXRButton} from './js/util/webxr-button.js';
			import {Scene} from './js/render/scenes/scene.js';
			import {Renderer, createWebGLContext} from './js/render/core/renderer.js';
			import {Node} from './js/render/core/node.js';
			import {Gltf2Node} from './js/render/nodes/gltf2.js';
			import {DropShadowNode} from './js/render/nodes/drop-shadow.js';
			import {vec3} from './js/render/math/gl-matrix.js';
			import {Ray} from './js/render/math/ray.js';

			// XR globals.
			let xrButton = null;
			let xrRefSpace = null;
			let xrViewerSpace = null;
			let xrHitTestSource = null;

			// WebGL scene globals.
			let gl = null;
			let renderer = null;
			let scene = new Scene();
			scene.enableStats(false);

			let arObject1 = new Node();
			arObject1.visible = false;
			scene.addNode(arObject1);

			let arObject2 = new Node();
			arObject2.visible = false;
			scene.addNode(arObject2);

			let arObject3 = new Node();
			arObject3.visible = false;
			scene.addNode(arObject3);

			let flower = new Gltf2Node({url: 'media/gltf/sunflower/cube.gltf'});
			arObject1.addNode(flower);

			let tree = new Gltf2Node({url: 'media/gltf/tree/cube.gltf'});
			arObject2.addNode(tree);

			let house = new Gltf2Node({url: 'media/gltf/house/cube.gltf'});
			arObject3.addNode(house);

			let reticle = new Gltf2Node({url: 'media/gltf/reticle/reticle.gltf'});
			reticle.visible = false;
			scene.addNode(reticle);

			// Having a really simple drop shadow underneath an object helps ground
			// it in the world without adding much complexity.
			let shadow1 = new DropShadowNode();
			vec3.set(shadow1.scale, 0.15, 0.15, 0.15);
			arObject1.addNode(shadow1);

			let shadow2 = new DropShadowNode();
			vec3.set(shadow2.scale, 0.15, 0.15, 0.15);
			arObject2.addNode(shadow2);

			let shadow3 = new DropShadowNode();
			vec3.set(shadow3.scale, 0.15, 0.15, 0.15);
			arObject3.addNode(shadow3);

			const MAX_OBJECTS = 30;
			let objects = [];

			// Ensure the background is transparent for AR.
			scene.clear = false;

			function initXR() {
				xrButton = new WebXRButton({
					onRequestSession: () => onRequestSession(1),
					onEndSession: onEndSession,
					textEnterXRTitle: "START AR",
					textXRNotFoundTitle: "AR NOT FOUND",
					textExitXRTitle: "EXIT AR",
				});
				document.querySelector('body').appendChild(xrButton.domElement);

				if (navigator.xr) {
					navigator.xr.isSessionSupported('immersive-ar').then((supported) => {
						xrButton.enabled = supported;
					});
				}
			}

			function onRequestSession(buttonNumber) {
				return navigator.xr.requestSession('immersive-ar', { requiredFeatures: ['local', 'hit-test'] })
					.then((session) => {
						xrButton.setSession(session);
						onSessionStarted(session, buttonNumber);
					});
			}

			function onSessionStarted(session, buttonNumber) {
				session.addEventListener('end', onSessionEnded);
				session.addEventListener('select', (event) => onSelect(event, buttonNumber));

				if (!gl) {
					gl = createWebGLContext({ xrCompatible: true });
					renderer = new Renderer(gl);
					scene.setRenderer(renderer);
				}

				session.updateRenderState({ baseLayer: new XRWebGLLayer(session, gl) });

				// In this sample we want to cast a ray straight out from the viewer's
				// position and render a reticle where it intersects with a real world
				// surface. To do this we first get the viewer space, then create a
				// hitTestSource that tracks it.
				session.requestReferenceSpace('viewer').then((refSpace) => {
					xrViewerSpace = refSpace;
					session.requestHitTestSource({ space: xrViewerSpace }).then((hitTestSource) => {
						xrHitTestSource = hitTestSource;
					});
				});

				session.requestReferenceSpace('local').then((refSpace) => {
					xrRefSpace = refSpace;
					session.requestAnimationFrame(onXRFrame);
				});
			}

			function onEndSession(session) {
				xrHitTestSource.cancel();
				xrHitTestSource = null;
				session.end();
			}

			function onSessionEnded(event) {
				xrButton.setSession(null);
			}

			// Adds a new object to the scene at the
			// specified transform.
			function addARObjectAt(matrix, buttonNumber) {
				let newObject;
				if (buttonNumber === 1) {
					newObject = arObject1.clone();
				} else if (buttonNumber === 2) {
					newObject = arObject2.clone();
				} else if (buttonNumber === 3) {
					newObject = arObject3.clone();
				}
				newObject.visible = true;
				newObject.matrix = matrix;
				scene.addNode(newObject);

				objects.push(newObject);

				// For performance reasons if we add too many objects start
				// removing the oldest ones to keep the scene complexity
				// from growing too much.
				if (objects.length > MAX_OBJECTS) {
					let oldObject = objects.shift();
					scene.removeNode(oldObject);
				}
			}

			let rayOrigin = vec3.create();
			let rayDirection = vec3.create();
			function onSelect(event, buttonNumber) {
				if (reticle.visible) {
					// The reticle should already be positioned at the latest hit point, 
					// so we can just use it's matrix to save an unnecessary call to 
					// event.frame.getHitTestResults.
					addARObjectAt(reticle.matrix, buttonNumber);
				}
			}

			// Called every time a XRSession requests that a new frame be drawn.
			function onXRFrame(t, frame) {
				let session = frame.session;
				let pose = frame.getViewerPose(xrRefSpace);

				reticle.visible = false;

				// If we have a hit test source, get its results for the frame
				// and use the pose to display a reticle in the scene.
				if (xrHitTestSource && pose) {
					let hitTestResults = frame.getHitTestResults(xrHitTestSource);
					if (hitTestResults.length > 0) {
						let pose = hitTestResults[0].getPose(xrRefSpace);
						reticle.visible = true;
						reticle.matrix = pose.transform.matrix;
					}
				}

				scene.startFrame();
				session.requestAnimationFrame(onXRFrame);
				scene.drawXRFrame(frame, pose);
				scene.endFrame();
			}

			document.querySelectorAll('.card-product').forEach((product, index) => {
				product.addEventListener('click', () => {
					onRequestSession(index % 3 + 1);
				});
			});

			// Start the XR application.
			initXR();
		</script>
	</body>
</html>
